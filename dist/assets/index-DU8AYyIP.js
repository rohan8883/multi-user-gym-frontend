import{j as e,g as l,_ as c,H as C,S as H}from"./index-CJyZ3len.js";import{u as R,b as k,a as P,P as z}from"./index-xAMIIVWc.js";import{r as N}from"./router-Bu5b4_LN.js";import{h as Y}from"./moment-BjLXg0w5.js";import{C as D,a as G,d as J,b as K}from"./card-INbucF__.js";import{T as O,a as Q,b as T,c as m,d as U,e as p}from"./table-CoCyuKV_.js";import{u as V,R as q}from"./FileUpload-BDeXmpoX.js";import{F as W,R as E,c as X,a as F,g as Z}from"./RHFTextField-C0movAlW.js";import{o as ee}from"./yup-DK8JKLPX.js";import{B as ae}from"./ButtonLoading-Dh6bV_mB.js";import"./input-DvRl1kRW.js";import{S as _}from"./separator-pQeVOdQd.js";import{D as se}from"./index-CPm3iCT8.js";import{S as te}from"./index-DSq1Ur8q.js";import"./axios-DmypytPv.js";import"./select-D1QcyAvF.js";const ne=X().shape({planMappingName:F().required("Month name is required"),planId:F().required("Plan is required"),monthId:F().required("Month is required"),amount:Z().required("Amount is required")});function ie({open:I,setOpen:b,title:w,id:M,edit:i,setEdit:v,refetch:L}){var h,x,s,d;const y=R({}),S=k({}),{data:a,isFetching:$}=P({api:`${l.planMappingById}/${M}`,options:{enabled:i}}),u=P({api:`${l.getAllActivePlan}`,key:"activePlanList",options:{enabled:!0}}),o=P({api:`${l.getAllActiveMonths}`,key:"activeMonthList",options:{enabled:!0}}),r=V({resolver:ee(ne)}),A=async t=>{var j,g,f,B;try{if(i&&t){const n=await S.mutateAsync({api:`${l.updatePlanMappingById}/${M}`,data:t});(j=n.data)!=null&&j.success?c.success((g=n==null?void 0:n.data)==null?void 0:g.message):c.error(n.data.message)}else{const n=await y.mutateAsync({api:l.createMappingPlan,data:t});(f=n.data)!=null&&f.success?c.success((B=n==null?void 0:n.data)==null?void 0:B.message):c.error("Month not created successfully"),r.reset({planMappingName:"",planId:"",monthId:"",amount:0})}b(!1),v(!1),L()}catch{}};return N.useEffect(()=>{var t,j,g,f;i&&a?r.reset({planMappingName:(t=a==null?void 0:a.data)==null?void 0:t.planMappingName,planId:(j=a==null?void 0:a.data)==null?void 0:j.planId,monthId:(g=a==null?void 0:a.data)==null?void 0:g.monthId,amount:(f=a==null?void 0:a.data)==null?void 0:f.amount}):r.reset({planMappingName:"",planId:"",monthId:"",amount:0})},[i,a]),e.jsx(se,{open:I,setOpen:b,title:w,setEdit:v,edit:i,isLoading:$,children:e.jsx(W,{methods:r,onSubmit:r.handleSubmit(A),children:e.jsxs("div",{className:"gap-y-4 gap-x-2 grid grid-cols-1",children:[e.jsx("div",{children:e.jsx(E,{name:"planMappingName",placeholder:"Enter plan mapping name"})}),e.jsx("div",{children:e.jsx(q,{name:"planId",label:"Select Plan",data:((x=(h=u==null?void 0:u.data)==null?void 0:h.data)==null?void 0:x.map(t=>({value:t._id,label:t.planName})))||[]})}),e.jsx("div",{children:e.jsx(q,{name:"monthId",label:"Select Month",data:((d=(s=o==null?void 0:o.data)==null?void 0:s.data)==null?void 0:d.map(t=>({value:t._id,label:t.monthName})))||[]})}),e.jsx("div",{children:e.jsx(E,{name:"amount",placeholder:"Enter amount",type:"number"})}),e.jsx(_,{}),e.jsx("div",{children:e.jsx(ae,{size:"sm",isLoading:r.formState.isSubmitting,type:"submit",className:"w-full",children:"Submit"})})]})})})}function re(){var o,r,A,h,x;const I=k({}),[b,w]=N.useState(""),[M,i]=N.useState(!1),[v,L]=N.useState(""),[y,S]=N.useState(!1),a=P({api:`${(o=l)==null?void 0:o.getAllMappingPlans}`,key:"planMappingList",options:{enabled:!0}}),$=s=>{S(!0),i(!0),L(s)},u=async s=>{try{const d=await I.mutateAsync({api:`${l.deletePlanMappingById}/${s}`});d.data.success?(c.success(d.data.message),a.refetch()):c.error(d.data.message)}catch{c.error("Something went wrong")}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(ie,{open:M,setOpen:i,title:y?"Edit Month":"Add Month",id:v,edit:y,setEdit:S,refetch:a.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex justify-between w-full gap-2",children:[e.jsx("div",{children:e.jsx(te,{search:b,setSearch:w,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx("div",{children:e.jsx(C,{size:"sm",className:"flex items-center gap-2",onClick:()=>i(!0),children:"Add New"})})]}),e.jsxs(D,{className:"w-full overflow-scroll",children:[e.jsx(G,{className:"px-7",children:e.jsxs(J,{children:["Total Plan Mapping: ",(A=(r=a==null?void 0:a.data)==null?void 0:r.data)==null?void 0:A.length]})}),e.jsx(K,{children:a.isLoading?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx(H,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(m,{className:"",children:"PLan Name"}),e.jsx(m,{className:"",children:"Month Name"}),e.jsx(m,{className:"",children:"Amount"}),e.jsx(m,{className:"",children:"Created at"}),e.jsx(m,{className:"",children:"Status"}),e.jsx(m,{className:"text-center",children:"Action"})]})}),e.jsx(U,{children:(x=(h=a==null?void 0:a.data)==null?void 0:h.data)==null?void 0:x.map(s=>e.jsxs(T,{children:[e.jsx(p,{children:s.plan}),e.jsx(p,{children:s.month}),e.jsx(p,{children:s.amount}),e.jsx(p,{children:Y(s.createdAt).format("DD-MM-YYYY")}),e.jsx(p,{children:s.status==1?"Active":"Inactive"}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{size:"sm",className:"bg-primary",onClick:()=>$(s._id),children:"Edit"}),e.jsx(C,{size:"sm",className:s.status==1?"bg-destructive":"bg-green-700",onClick:()=>u(s._id),children:s.status==1?"Deactivate":"Activate"})]})})]},s._id))})]}),e.jsx(_,{className:"mt-4 mb-2"})]})})]})]})]})}function ye(){return e.jsx(z,{title:"Plan List",children:e.jsx("div",{className:" mt-3 mb-2",children:e.jsx(re,{})})})}export{ye as default};
