import{g as u,j as e,_ as m,B as S}from"./index-5LZ_nlU9.js";import{d as T,r as p}from"./router-Bu5b4_LN.js";import{u as R,R as N,F as B,T as C}from"./FileUpload-B8QEeBcg.js";import{o as D}from"./yup-JIk-gZdR.js";import{F as _,R as c,c as $,a as n,e as I}from"./RHFTextField-BDc5GpPO.js";import{u as L,a as f,P as z}from"./index-4gDiAr6t.js";import{R as H}from"./RHFTextArea-CPKwknZ8.js";import{B as y}from"./ButtonLoading-BOLt1f3D.js";import"./input-5M_0HrzI.js";import{T as k,a as U,b as v,c as x,d as V,e as h}from"./table-B4nQUSNl.js";import{C as W}from"./index-Dkup9m_i.js";import{r as G}from"./resizeImage-nNayW6hE.js";import"./axios-DmypytPv.js";import"./select-UqvSj_yK.js";const O=$().shape({memberName:n().required("Member Name is required"),address:n().required("Address is required"),mobile:n().required("Mobile is required"),dob:n().required("Date of Birth is required"),email:n().notRequired().email().label("Email"),gender:n().required().label("Gender"),imageUrl:I().nullable(),weight:n().required("Weight is required"),planMapping:n()});function de(){var j;const M=T(),g=L({}),[o,b]=p.useState([]),[l,w]=p.useState(null),[F,A]=p.useState(null),t=R({defaultValues:{memberName:"",address:"",mobile:"",gender:"",dob:"",email:"",weight:"",imageUrl:null,planMapping:""},resolver:D(O)}),E=async a=>{if(o.length===0)return alert("Please add at least one plan List");const s=new FormData;s.append("memberName",a.memberName),s.append("address",a.address),s.append("mobile",a.mobile),s.append("dob",a.dob),s.append("email",(a==null?void 0:a.email)??""),s.append("planMappingId",JSON.stringify(o.map(r=>r._id))),s.append("gender",a.gender),s.append("weight",a.weight),s.append("imageUrl",F),W("Are you sure?","Do you want to add this member?",async()=>{try{const r=await g.mutateAsync({api:u.createMember,data:s});r.data.success?(b([]),m.success(r.data.message),M(`/gym-app/view-member/${r.data.data._id}`)):m.error(r.data.message)}catch{m.error("Something went wrong")}})},P=f({api:u.getAllPlanMapping,key:"get-plan-mapping",options:{enabled:!0}}),d=f({api:`${u.getPlanMappingById}?id=${t.watch("planMapping")}`,key:"get-plan-mapping-by-id-save",value:[t.watch("planMapping")],options:{enabled:!!t.watch("planMapping")}}),q=async()=>{var i;if(((i=l==null?void 0:l[0])==null?void 0:i.size)>20*1024*1024)return m.error("File size is too large");const a=l==null?void 0:l[0];if(!a)return;const s=await G(a),r=new File([s],a==null?void 0:a.name,{type:a==null?void 0:a.type});A(r)};return p.useEffect(()=>{l&&q()},[l]),e.jsxs(z,{title:"Add Member",children:[e.jsx("div",{className:"flex items-center justify-between mt-4",children:e.jsx("h1",{className:"text-base font-semibold text-muted-foreground",children:"ADD MEMBER"})}),e.jsx("div",{className:"border-t border-secondary mt-3"}),e.jsxs(_,{methods:t,onSubmit:t.handleSubmit(E),children:[e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsx(c,{name:"memberName",label:"Member Name",placeholder:"Enter Member Name"})}),e.jsx("div",{children:e.jsx(c,{name:"email",label:"Email",placeholder:"Enter Email"})}),e.jsx("div",{children:e.jsx(c,{name:"mobile",label:"Mobile",placeholder:"Enter Mobile",inputValidation:["mobile","number"]})}),e.jsx("div",{children:e.jsx(c,{type:"date",name:"dob",label:"Date of Birth",placeholder:"Enter Date of Birth"})}),e.jsx("div",{children:e.jsx(c,{name:"weight",label:"Weight",placeholder:"Enter Weight"})}),e.jsx("div",{children:e.jsx(N,{label:"Gender",name:"gender",data:[{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"Other",value:"other"}]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(B,{onChangeValue:w,files:l,maxFiles:1,maxSize:20*1024*1024,accept:"image/*",multiple:!1})}),e.jsx("div",{className:"col-span-2",children:e.jsx(H,{name:"address",label:"Address",placeholder:"Enter Address"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(N,{name:"planMapping",label:"Select Plan List",data:((j=P.data)==null?void 0:j.data.map(a=>({label:a.plan+` - month ${a.month}`,value:a._id})))||[]})}),e.jsx("div",{className:"mt-6",children:e.jsx(y,{isLoading:d.isFetching,disabled:d.isFetching,type:"button",onClick:()=>{if(t.watch("planMapping")==="")return m.error("Please select plan List");if(o.find(s=>{var r,i;return s.plan==((i=(r=d==null?void 0:d.data)==null?void 0:r.data)==null?void 0:i.plan)}))return m.error("Plan already added");b(s=>{var r;return[...s,(r=d.data)==null?void 0:r.data]})},className:"bg-primary text-white w-full h-9",children:e.jsx("h1",{className:"text-xs",children:"Add Plan"})})})]})})]})}),e.jsx("div",{className:"border-t border-secondary mt-5"}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1",children:e.jsxs(k,{children:[e.jsx(U,{children:e.jsxs(v,{children:[e.jsx(x,{className:"text-xs",children:"Plan"}),e.jsx(x,{className:"text-xs",children:"Month"}),e.jsx(x,{className:"text-xs",children:"Amount"}),e.jsx(x,{className:"text-xs",children:"Action"})]})}),e.jsx(V,{children:o.map((a,s)=>e.jsxs(v,{children:[e.jsx(h,{className:"text-xs py-2.5",children:a==null?void 0:a.plan}),e.jsx(h,{className:"text-xs py-2.5",children:a==null?void 0:a.month}),e.jsx(h,{className:"text-xs py-2.5",children:a==null?void 0:a.amount}),e.jsx(h,{className:"text-xs py-2.5",children:e.jsx(S,{type:"button",className:"bg-red-100 text-white   flex items-center justify-center p-3",onClick:()=>{b(r=>r.filter(i=>(i==null?void 0:i._id)!==(a==null?void 0:a._id)))},children:e.jsx(C,{size:16,className:"text-red-700"})})})]},s+1))})]})}),e.jsx("div",{className:"border-t border-secondary mt-5"}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(y,{type:"submit",className:"bg-primary text-white",isLoading:g.isPending,children:"Add Member"})})]})]})]})}export{de as default};
