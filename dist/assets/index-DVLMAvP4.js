import{j as e,a as N,_ as m,u as F}from"./index-5LZ_nlU9.js";import{r as v}from"./router-Bu5b4_LN.js";import{u as P,P as E}from"./index-4gDiAr6t.js";import{a as I,C,I as A,b as R,c as g,d as y,u as T}from"./FileUpload-B8QEeBcg.js";import{F as S,R as $,c as w,a as b}from"./RHFTextField-BDc5GpPO.js";import{o as L}from"./yup-JIk-gZdR.js";import{g as O}from"./services-KQnp_8oA.js";import{B as k}from"./ButtonLoading-BOLt1f3D.js";import"./input-5M_0HrzI.js";import{u as q}from"./useTimer-B_7DHncw.js";import"./axios-DmypytPv.js";import"./select-UqvSj_yK.js";function D({name:r}){const{control:c}=I();return e.jsx(C,{name:r,control:c,render:({field:{ref:o,...n},fieldState:{error:l}})=>e.jsx(A,{maxLength:4,ref:o,inputMode:"numeric",className:`mt-1 ${l?"border-red-400":null}`,...n,children:e.jsxs(R,{children:[e.jsx(g,{index:0}),e.jsx(y,{className:"ml-2 mr-2"}),e.jsx(g,{index:1}),e.jsx(y,{className:"ml-2 mr-2"}),e.jsx(g,{index:2}),e.jsx(y,{className:"ml-2 mr-2"}),e.jsx(g,{index:3})]})})})}const M=w({mobile:b().required()});function B({next:r,data:c}){const o=P({}),n=T({defaultValues:{mobile:c.mobile},resolver:L(M)}),l=async i=>{var a,u,d,x;try{const s=await o.mutateAsync({api:N.sendOtpLogin,data:i});(a=s==null?void 0:s.data)!=null&&a.success?(r({...i,mobile:i==null?void 0:i.mobile,token:(u=s==null?void 0:s.data)==null?void 0:u.token}),m.success((d=s==null?void 0:s.data)==null?void 0:d.message)):m.error((x=s==null?void 0:s.data)==null?void 0:x.message)}catch(s){m.error(O(s))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 lg:px-0 mx-auto max-w-sm mb-4",children:[e.jsx("div",{className:"flex justify-center"}),e.jsx("h1",{className:"text-3xl font-bold text-center mt-4 text-green-400",children:"Send OTP"}),e.jsx("p",{className:"text-center mt-2 text-muted-foreground text-xs",children:"Enter your mobile to send OTP to your mobile number"})]}),e.jsx(S,{methods:n,onSubmit:n.handleSubmit(l),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx($,{type:"number",className:"rounded-xl py-6 px-5 w-full bg-background",name:"mobile",inputValidation:["number","mobile"],placeholder:"Enter your mobile number"})}),e.jsx("div",{children:e.jsx(k,{type:"submit",isLoading:n.formState.isSubmitting,className:"w-full rounded-xl py-5 px-4 mt-2 shadow-none",variant:"outline",children:"Send OTP"})})]})})]})}const G=w({mobile:b().required(),otp:b().required(),token:b()});function _({data:r,setData:c,prev:o}){const{login:n}=F(),{minutes:l,seconds:i,togglerTimer:a,runTimer:u}=q(.5),d=P({}),x=T({defaultValues:{mobile:r.mobile,otp:r.otp,token:r.token},resolver:L(G)}),s=async p=>{var f,h;try{const t=await d.mutateAsync({api:N.verifyOtpLogin,data:{mobile:p.mobile,otp:p.otp}});if((f=t==null?void 0:t.data)!=null&&f.success){const j=await n(t);j&&m.success(j==null?void 0:j.message)}else m.error((h=t==null?void 0:t.data)==null?void 0:h.message)}catch(t){m.error(O(t))}};v.useEffect(()=>(a(),()=>{a()}),[]);const V=async()=>{var p,f,h;try{const t=await d.mutateAsync({api:N.loginWithOtp,data:{mobile:r.mobile}});(p=t==null?void 0:t.data)!=null&&p.success?(m.success((f=t==null?void 0:t.data)==null?void 0:f.message),c({...r,otp:""}),x.setValue("otp",""),a()):m.error((h=t==null?void 0:t.data)==null?void 0:h.message)}catch(t){m.error(O(t))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 lg:px-0 mx-auto max-w-sm mb-4",children:[e.jsx("div",{className:"flex justify-center"}),e.jsx("h1",{className:"text-3xl font-bold text-center mt-4 text-green-400",children:"Verify OTP"}),e.jsxs("h1",{className:"text-center mt-2 text-muted-foreground text-xs",children:["Verify your OTP to reset your password",e.jsxs("p",{className:"text-center text-muted-foreground text-xs text-green-400",children:[r.mobile,"  ",e.jsx("button",{onClick:()=>o(r),className:"text-center mt-2  text-sm text-green-400 cursor-pointer hover:text-green-500 underline",children:"Edit"})]})]})]}),e.jsx(S,{methods:x,onSubmit:x.handleSubmit(s),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 flex justify-center items-center",children:e.jsx(D,{name:"otp"})}),e.jsx("div",{className:"px-6",children:e.jsx(k,{type:"submit",isLoading:x.formState.isSubmitting,className:"w-full rounded-xl py-5 px-4 mt-2 shadow-none",variant:"outline",children:"Verify OTP"})}),e.jsxs("div",{className:"text-center text-muted-foreground text-xs",children:[e.jsx("span",{children:"Didn't receive the OTP? "}),u?e.jsxs("span",{className:"text-center mt-2  text-sm text-green-400 cursor-pointer hover:text-green-500 underline",children:[l,":",i]}):e.jsx("button",{className:"text-center mt-2  text-sm text-green-400 cursor-pointer hover:text-green-500 underline",onClick:V,children:"Resend OTP"})]})]})})]})}function se(){const[r,c]=v.useState(0),[o,n]=v.useState({mobile:"",otp:"",token:""}),l=(a,u=!1)=>{n({...o,...a}),!u&&c(r+1)},i=a=>{n({...o,...a}),c(r-1)};return e.jsx(E,{title:"OTP LOGIN",children:e.jsx("div",{className:"flex flex-col w-full justify-center h-screen px-6 lg:px-0 mx-auto max-w-sm",children:{0:e.jsx(B,{next:l,data:o}),1:e.jsx(_,{next:l,prev:i,data:o,setData:n})}[r]||null})})}export{se as default};
